parameters:
  env(VERBOSE_ERRORS): false
  verbose_errors: '%env(bool:VERBOSE_ERRORS)%'

services:
  _defaults:
    public: true
    bind:
      $debug: '%verbose_errors%'
      $requestLogger: '@monolog.logger.request'

  # Auto-wired and auto-configured http event subscribers
  ExEss\Cms\Http\EventSubscriber\:
    autowire: true
    autoconfigure: true
    resource: '../../src/ExEss/Cms/Http/EventSubscriber'

  ExEss\Cms\Api\V8_Custom\Events\Listeners\EnhanceHeadersSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Api\V8_Custom\Service\Security'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Api\V8_Custom\Events\Listeners\EnhanceHeadersSubscriber' }]

  ExEss\Cms\Api\V8_Custom\Events\Listeners\ExternalApiLogSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Logger\Logger'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Api\V8_Custom\Events\Listeners\ExternalApiLogSubscriber' }]

  ExEss\Cms\Api\V8_Custom\Events\Listeners\UpdateLastLoginSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Api\V8_Custom\Events\Listeners\UpdateLastLoginSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\PreValidationSubscriber:
    lazy: true
    arguments:
      - '@service_container'
      - !tagged_iterator pre-validation-suggestion
      - '@doctrine.orm.entity_manager'
      - '@ExEss\Cms\Service\GridService'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\PreValidationSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\SuggestionsSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Component\Flow\Event\FlowEventDispatcher'
      - '@service_container'
      - !tagged_iterator suggestions
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\SuggestionsSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ResponseHandlerSubscriber:
    lazy: true
    arguments:
      $container: '@service_container'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ResponseHandlerSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\PreDispatchSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\PreDispatchSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\RecordIdSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\RecordIdSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\GuidanceSubscriber:
    lazy: true
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\GuidanceSubscriber' }]


  ExEss\Cms\Component\Flow\Event\Listeners\NextStepSubscriber:
    lazy: true
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\NextStepSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ProgressSubscriber:
    lazy: true
    arguments:
      - '@Symfony\Component\Translation\Translator'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ProgressSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ExternalFlowSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Servicemix\ExternalObjectHandler'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ExternalFlowSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\BaseEntitySubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\BaseEntitySubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ValidationSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Component\Flow\FlowValidator'
      - '@ExEss\Cms\Component\Flow\ActionFactory'
      - '@ExEss\Cms\Component\Flow\Builder\FormBuilder'
      - '@ExEss\Cms\Api\V8_Custom\Service\FlashMessages\FlashMessageContainer'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ValidationSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ChildModelSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Service\GridService'
      - '@ExEss\Cms\Component\Flow\Event\FlowEventDispatcher'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ChildModelSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\GridSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Service\GridService'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\GridSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\FormAndModelSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ExEss\Cms\Component\Flow\Builder\FormBuilder'
      - '@ExEss\Cms\Component\Flow\DefaultValueService'
      - '@ExEss\Cms\Service\GridService'
      - '@ExEss\Cms\Logger\Logger'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\FormAndModelSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ValueExpressionsSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\MultiLevelTemplate\TextFunctionHandler'
      - '@ExEss\Cms\Api\V8_Custom\Service\FlashMessages\FlashMessageContainer'
      - '@ExEss\Cms\Component\ExpressionParser\ParserService'
      - '@ExEss\Cms\Service\SelectWithSearchService'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ValueExpressionsSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\BreakoutSubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Service\RepeatableRowService'
      - '@ExEss\Cms\Component\Flow\Event\FlowEventDispatcher'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\BreakoutSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\SaveSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ExEss\Cms\Service\GridService'
      - '@ExEss\Cms\Component\Flow\SaveFlow'
      - '@ExEss\Cms\Component\Flow\MultiLineFlowSaver'
      - '@ExEss\Cms\Component\Flow\ActionFactory'
      - '@ExEss\Cms\Component\Flow\AfterSave\Handler\AfterSaveHandlerQueue'
      - '@ExEss\Cms\Component\Flow\Builder\FormBuilder'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\SaveSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\ModelCleanerSubscriber:
    lazy: true
    arguments:
      - '@doctrine.orm.entity_manager'
      - '@ExEss\Cms\Component\Flow\Builder\FormBuilder'
      - '@ExEss\Cms\Service\GridService'
      - '@ExEss\Cms\Logger\Logger'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\ModelCleanerSubscriber' }]

  ExEss\Cms\Component\Flow\Event\Listeners\GuidanceRecoverySubscriber:
    lazy: true
    arguments:
      - '@ExEss\Cms\Users\Service\GuidanceRecoveryService'
    tags: [{ name: 'crm.subscriber', key: 'ExEss\Cms\Component\Flow\Event\Listeners\GuidanceRecoverySubscriber' }]
